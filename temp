import org.springframework.batch.core.SkipListener;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.time.LocalDateTime;

public class CustomSkipListener implements SkipListener<CustomJsonFileModel, CustomJsonFileModel> {
    
    // Path to your error log file.
    private final String errorFilePath = "errors.log";
    
    @Override
    public void onSkipInRead(Throwable t) {
        // Optionally log read errors.
        writeError("Read error at " + LocalDateTime.now() + ": " + t.getMessage());
    }

    @Override
    public void onSkipInProcess(CustomJsonFileModel item, Throwable t) {
        // Log and write error details for processing errors.
        String errorMessage = "Processing error for item " + item + " at " + LocalDateTime.now()
                + ": " + t.getMessage();
        System.err.println(errorMessage);
        writeError(errorMessage);
    }

    @Override
    public void onSkipInWrite(CustomJsonFileModel item, Throwable t) {
        // Log and write error details for write errors.
        String errorMessage = "Write error for item " + item + " at " + LocalDateTime.now()
                + ": " + t.getMessage();
        System.err.println(errorMessage);
        writeError(errorMessage);
    }
    
    private void writeError(String errorMessage) {
        try(PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter(errorFilePath, true)))) {
            pw.println(errorMessage);
        } catch (Exception e) {
            System.err.println("Error writing to error file: " + e.getMessage());
        }
    }
}
