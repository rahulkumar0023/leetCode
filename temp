Timport org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

class FileSanitizerTest {

    @Test
    void sanitizeFilenamePreserveExtension_keepsExtension() {
        String input = "invoice test?.xml";
        String result = FileNameUtil.sanitizeFilenamePreserveExtension(input);

        assertEquals("invoice_test_.xml", result);
    }

    @Test
    void sanitizeFilenamePreserveExtension_handlesPdf() {
        String input = "my file name.pdf";
        String result = FileNameUtil.sanitizeFilenamePreserveExtension(input);

        assertEquals("my_file_name.pdf", result);
    }

    @Test
    void sanitizeFilenamePreserveExtension_sanitizesUnsafeCharacters() {
        String input = "bad:name*file?.xml";
        String result = FileNameUtil.sanitizeFilenamePreserveExtension(input);

        assertEquals("bad_name_file_.xml", result);
    }

    @Test
    void sanitizeFilenamePreserveExtension_handlesNoExtension() {
        String input = "file name without ext";
        String result = FileNameUtil.sanitizeFilenamePreserveExtension(input);

        assertEquals("file_name_without_ext", result);
    }

    @Test
    void sanitizeFilenamePreserveExtension_handlesTrailingDot() {
        String input = "file.";
        String result = FileNameUtil.sanitizeFilenamePreserveExtension(input);

        assertEquals("file_", result);
    }

    @Test
    void sanitizeFilenamePreserveExtension_handlesNull() {
        assertEquals("", FileNameUtil.sanitizeFilenamePreserveExtension(null));
    }

    @Test
    void sanitizeFilenamePreserveExtension_handlesBlank() {
        assertEquals("", FileNameUtil.sanitizeFilenamePreserveExtension("   "));
    }

    @Test
    void sanitizeFilenamePreserveExtension_keepsDotsInExtensionOnly() {
        String input = "26.51.510012.xml";
        String result = FileNameUtil.sanitizeFilenamePreserveExtension(input);

        // only last dot is extension separator
        assertEquals("26_51_510012.xml", result);
    }
}
