FROM registry.access.redhat.com/ubi8/openjdk-17

# Set JAVA_HOME dynamically
ENV JAVA_HOME=$(dirname $(dirname $(readlink -f $(which java))))
ENV PATH="${JAVA_HOME}/bin:${PATH}"

# Copy and import the Keycloak certificate
COPY keycloak.cer /etc/pki/ca-trust/source/anchors/keycloak.cer
RUN update-ca-trust extract && \
    keytool -import -trustcacerts -keystore $JAVA_HOME/lib/security/cacerts \
    -storepass changeit -noprompt -alias keycloak -file /etc/pki/ca-trust/source/anchors/keycloak.cer

# Copy and run the app
WORKDIR /app
COPY target/myapp.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
