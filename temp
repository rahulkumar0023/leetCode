FROM registry.access.redhat.com/ubi8/openjdk-17

# Create a directory for the certificate
RUN mkdir -p /applis/certs

# Copy the Keycloak certificate to the container
COPY keycloak.cer /applis/certs/keycloak.cer

# Import the Keycloak certificate into Java's trust store
RUN keytool -import -trustcacerts \
    -keystore /etc/pki/java/cacerts \
    -storepass changeit -noprompt -alias keycloak-cert \
    -file /applis/certs/keycloak.cer

# Set working directory
WORKDIR /app

# Copy application JAR
COPY target/myapp.jar app.jar
EXPOSE 8080

# Run the application
CMD ["java", "-jar", "app.jar"]
