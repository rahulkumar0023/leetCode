Absolutely! Here's the complete, updated solution with:

âœ… A configurable `InvoiceWriter`
âœ… A Spring-friendly constructor for `@Value` injection
âœ… A convenient alternate constructor for tests
âœ… A JUnit 5 test that verifies output without deploying anything

---

## âœ… 1. `InvoiceWriter.java`

```java
package com.example.batch.writer;

import jakarta.xml.bind.JAXBElement;
import lombok.extern.slf4j.Slf4j;
import network.oxalis.peppol.ubl2.jaxb.InvoiceType;
import org.springframework.batch.item.Chunk;
import org.springframework.batch.item.ItemWriter;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.oxm.jaxb.Jaxb2Marshaller;
import org.springframework.stereotype.Component;

import javax.xml.namespace.QName;
import javax.xml.transform.stream.StreamResult;
import java.io.File;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.List;
import java.util.UUID;

@Slf4j
@Component
public class InvoiceWriter implements ItemWriter<InvoiceType> {

    private final Path xmlDir;
    private final Path pdfDir;
    private final Jaxb2Marshaller marshaller;

    // Spring-injected constructor
    public InvoiceWriter(
            @Value("${invoice.output.xml-dir:/tmp/processed/xml}") String xmlDirPath,
            @Value("${invoice.output.pdf-dir:/tmp/processed/pdf}") String pdfDirPath
    ) {
        this(Path.of(xmlDirPath), Path.of(pdfDirPath));
    }

    // Alternate constructor for testing
    public InvoiceWriter(Path xmlDir, Path pdfDir) {
        this.xmlDir = xmlDir;
        this.pdfDir = pdfDir;
        this.marshaller = new Jaxb2Marshaller();
        this.marshaller.setClassesToBeBound(InvoiceType.class);
        this.marshaller.afterPropertiesSet();
    }

    @Override
    public void write(Chunk<? extends InvoiceType> invoices) throws Exception {
        Files.createDirectories(xmlDir);
        Files.createDirectories(pdfDir);

        for (InvoiceType invoice : invoices) {
            String id = (invoice.getID() != null && invoice.getID().getValue() != null)
                    ? invoice.getID().getValue()
                    : UUID.randomUUID().toString();

            File xmlOut = xmlDir.resolve("invoice-" + id + ".xml").toFile();
            try (FileOutputStream fos = new FileOutputStream(xmlOut)) {
                JAXBElement<InvoiceType> jaxbElement = new JAXBElement<>(
                        new QName("urn:oasis:names:specification:ubl:schema:xsd:Invoice-2", "Invoice"),
                        InvoiceType.class,
                        invoice
                );
                marshaller.marshal(jaxbElement, new StreamResult(fos));
                log.info("âœ… XML written: {}", xmlOut.getAbsolutePath());
            }

            File pdfOut = pdfDir.resolve("invoice-" + id + ".pdf").toFile();
            try (FileWriter fw = new FileWriter(pdfOut)) {
                fw.write("Invoice ID: " + id + "\n(More details...)");
                log.info("ðŸ“„ PDF generated: {}", pdfOut.getAbsolutePath());
            }
        }
    }
}
```

---

## âœ… 2. `InvoiceWriterTest.java`

```java
package com.example.batch.writer;

import network.oxalis.peppol.ubl2.jaxb.IDType;
import network.oxalis.peppol.ubl2.jaxb.InvoiceType;
import org.junit.jupiter.api.*;
import org.springframework.batch.item.Chunk;

import java.io.File;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

class InvoiceWriterTest {

    private Path xmlDir;
    private Path pdfDir;
    private InvoiceWriter writer;

    @BeforeEach
    void setup() throws Exception {
        xmlDir = Files.createTempDirectory("test-xml");
        pdfDir = Files.createTempDirectory("test-pdf");
        writer = new InvoiceWriter(xmlDir, pdfDir);
    }

    @AfterEach
    void cleanup() throws Exception {
        Files.walk(xmlDir).map(Path::toFile).forEach(File::delete);
        Files.walk(pdfDir).map(Path::toFile).forEach(File::delete);
    }

    @Test
    void shouldGenerateXmlAndPdfFiles() throws Exception {
        InvoiceType invoice = new InvoiceType();
        IDType id = new IDType();
        id.setValue("TEST-123");
        invoice.setID(id);

        writer.write(new Chunk<>(List.of(invoice)));

        Path expectedXml = xmlDir.resolve("invoice-TEST-123.xml");
        Path expectedPdf = pdfDir.resolve("invoice-TEST-123.pdf");

        assertTrue(Files.exists(expectedXml), "XML file should exist");
        assertTrue(Files.exists(expectedPdf), "PDF file should exist");
    }
}
```

---

### ðŸ”§ Add this to `application.yml` (optional):

```yaml
invoice:
  output:
    xml-dir: /tmp/processed/xml
    pdf-dir: /tmp/processed/pdf
```

---

Would you like to assert **XML contents** too in the tests? I can help with that next.
