#!/bin/bash

INPUT_FILE="hosts.csv"
OUTPUT_FILE="nslookup_results.csv"

# Write header to output
echo "hostname,ip_address" > "$OUTPUT_FILE"

# Read input file line by line (skip header)
tail -n +2 "$INPUT_FILE" | while IFS=, read -r hostname
do
    echo "Looking up $hostname ..."
    ip=$(nslookup "$hostname" 2>/dev/null | awk '/^Address: / { print $2 }' | tail -n1)
    
    if [ -z "$ip" ]; then
        ip="lookup_failed"
    fi

    # Append result to output CSV
    echo "$hostname,$ip" >> "$OUTPUT_FILE"
done

echo "Done! Results saved to $OUTPUT_FILE"
